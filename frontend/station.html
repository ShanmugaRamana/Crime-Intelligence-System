<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station-wise — Zone 1 Crime Intelligence System</title>
    <meta name="description" content="Station-wise crime analysis — Aurangabad City Police">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

    <!-- Floating Top Nav -->
    <nav class="top-nav">
        <div class="nav-inner">
            <a class="nav-brand" href="/">
                <img src="/img/logo.png" alt="Logo">
                <div class="nav-brand-text">
                    <span class="nav-brand-title" data-t="appTitle">Zone 1 Crime Intelligence System</span>
                    <span class="nav-brand-sub" data-t="appSubtitle">Aurangabad City Police</span>
                </div>
            </a>
            <div class="nav-divider"></div>
            <div class="nav-tabs">
                <a href="/index.html" class="nav-tab" id="navOverall">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="7" rx="1" />
                        <rect x="14" y="3" width="7" height="7" rx="1" />
                        <rect x="3" y="14" width="7" height="7" rx="1" />
                        <rect x="14" y="14" width="7" height="7" rx="1" />
                    </svg>
                    <span data-t="navOverall">Overall Intelligence</span>
                </a>
                <a href="/station.html" class="nav-tab active" id="navStation">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16" />
                    </svg>
                    <span data-t="navStation">Station-wise</span>
                </a>
            </div>
            <div class="nav-right">
                <div class="nav-status">
                    <span class="status-dot"></span>
                    <span id="lastUpdated"></span>
                </div>
                <button class="btn-outline" id="langToggle">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" />
                        <path
                            d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10A15.3 15.3 0 0112 2" />
                    </svg>
                    <span>मराठी</span>
                </button>
                <button class="btn-outline" id="btnPrint">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" />
                        <rect x="6" y="14" width="12" height="8" />
                    </svg>
                    <span data-t="printBtn">Print</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Chart Modal -->
    <div class="chart-modal-overlay" id="chartModal">
        <div class="chart-modal">
            <div class="chart-modal-header">
                <div class="chart-modal-title" id="modalTitle"></div>
                <button class="chart-modal-close" id="modalClose">✕</button>
            </div>
            <div class="chart-modal-body">
                <canvas id="modalChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="page-shell">
        <!-- Filter bar -->
        <div class="filter-bar reveal" style="--d:0.05s">
            <div class="filter-group">
                <label data-t="filterYear">Year</label>
                <select id="filterYear"></select>
            </div>
            <div class="filter-group">
                <label data-t="filterMonth">Month</label>
                <select id="filterMonth"></select>
            </div>
            <div class="filter-group">
                <label data-t="filterCrimeType">Crime Type</label>
                <select id="filterCrimeType"></select>
            </div>
            <button class="btn-reset" id="btnReset" data-t="filterReset">Reset Filters</button>
        </div>

        <!-- Station selector -->
        <div class="section-label reveal" style="--d:0.08s" data-t="selectStation">Select a Police Station</div>
        <div class="station-selector" id="stationSelector"></div>

        <!-- Station content (shown after selection) -->
        <div id="stationContent" style="display:none;">
            <div class="kpi-row">
                <div class="kpi-card reveal-scale" style="--d:0.05s">
                    <div class="kpi-badge indigo">
                        <svg viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                        </svg>
                    </div>
                    <div class="kpi-info">
                        <div class="kpi-label" data-t="totalCrimes">Total Crimes</div>
                        <div class="kpi-value" id="kpiTotal">—</div>
                    </div>
                </div>
                <div class="kpi-card reveal-scale" style="--d:0.11s">
                    <div class="kpi-badge blue">
                        <svg viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <path d="M21 21l-4.35-4.35" />
                        </svg>
                    </div>
                    <div class="kpi-info">
                        <div class="kpi-label" data-t="underInvestigation">Under Investigation</div>
                        <div class="kpi-value" id="kpiInvestigation">—</div>
                    </div>
                </div>
                <div class="kpi-card reveal-scale" style="--d:0.17s">
                    <div class="kpi-badge emerald">
                        <svg viewBox="0 0 24 24">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14" />
                            <path d="M22 4L12 14.01l-3-3" />
                        </svg>
                    </div>
                    <div class="kpi-info">
                        <div class="kpi-label" data-t="closedCases">Closed Cases</div>
                        <div class="kpi-value" id="kpiClosed">—</div>
                    </div>
                </div>
                <div class="kpi-card reveal-scale" style="--d:0.23s">
                    <div class="kpi-badge amber">
                        <svg viewBox="0 0 24 24">
                            <path d="M23 6l-9.5 9.5-5-5L1 18" />
                            <path d="M17 6h6v6" />
                        </svg>
                    </div>
                    <div class="kpi-info">
                        <div class="kpi-label" data-t="closureRate">Closure Rate</div>
                        <div class="kpi-value" id="kpiRate">—</div>
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card span-2 reveal" style="--d:0.05s" data-chart="stationCrimes">
                    <div class="chart-title" data-t="stationCrimeTypes">Crime Types at Station</div>
                    <div class="chart-wrapper"><canvas id="chartStationCrimes"></canvas></div>
                </div>
                <div class="chart-card reveal" style="--d:0.12s" data-chart="stationDoughnut">
                    <div class="chart-title" data-t="stationInvVsClosed">Investigation vs Closed</div>
                    <div class="chart-wrapper"><canvas id="chartStationDoughnut"></canvas></div>
                </div>
                <div class="chart-card span-2 reveal" style="--d:0.05s" data-chart="stationTrend">
                    <div class="chart-title" data-t="stationMonthlyTrend">Monthly Trend</div>
                    <div class="chart-wrapper"><canvas id="chartStationTrend"></canvas></div>
                </div>
                <div class="chart-card reveal" style="--d:0.12s" data-chart="stationMonthly">
                    <div class="chart-title" data-t="stationMonthBreakdown">Month-wise Breakdown</div>
                    <div class="chart-wrapper"><canvas id="chartStationMonthly"></canvas></div>
                </div>
                <div class="chart-card full-width reveal" style="--d:0.05s">
                    <div class="chart-title" data-t="stationDataTable">Station Records</div>
                    <div class="data-table-wrapper" id="stationTableContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="/libs/chart.min.js"></script>
    <script src="/js/translations.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/station.js"></script>

    <!-- Scroll-reveal IntersectionObserver -->
    <script>
        (function () {
            const selectors = '.reveal, .reveal-scale, .reveal-left, .reveal-right';

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('revealed');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.08, rootMargin: '0px 0px -40px 0px' });

            // Expose globally so dynamic content (station.js) can register
            window._revealObserver = observer;

            // Observe initial elements
            document.querySelectorAll(selectors).forEach(el => observer.observe(el));

            // Re-observe when station content becomes visible (dynamically shown)
            const stationContent = document.getElementById('stationContent');
            if (stationContent) {
                const mo = new MutationObserver(() => {
                    if (stationContent.style.display !== 'none') {
                        stationContent.querySelectorAll(selectors).forEach(el => {
                            if (!el.classList.contains('revealed')) {
                                el.classList.remove('revealed');
                                void el.offsetWidth; // force reflow
                                observer.observe(el);
                            }
                        });
                    }
                });
                mo.observe(stationContent, { attributes: true, attributeFilter: ['style'] });
            }
        })();
    </script>
</body>

</html>